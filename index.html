<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Great Date</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Подключение API Яндекс Карт -->
    <script src="https://api-maps.yandex.ru/2.1/?apikey=fc21015a-a988-4d6f-91b0-5c86c3db620b&lang=ru_RU" type="text/javascript"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: white;
            overflow-x: hidden;
        }

        /* Страницы */
        .page {
            display: none;
            flex: 1;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 15px 12px;
            text-align: center;
            width: 100%;
        }

        .page.active {
            display: flex;
        }

        /* Общие стили заголовков */
        .header {
            margin-bottom: 15px;
        }

        .title {
            font-size: 1.8rem;
            font-weight: bold;
            background: linear-gradient(45deg, #667eea, #764ba2, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            margin-bottom: 4px;
        }

        .subtitle {
            font-size: 0.75rem;
            opacity: 0.8;
            font-weight: 300;
            color: #cccccc;
        }

        /* СТРАНИЦА 1: Мини-профили */
        .profiles-container {
            display: flex;
            flex-direction: column;
            gap: 6px;
            width: 100%;
            max-width: 300px;
            margin: 10px 0;
            flex: 1;
            justify-content: center;
        }

        .profile-card {
            background: rgba(30, 30, 46, 0.8);
            border-radius: 6px;
            padding: 6px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.2s ease;
            cursor: pointer;
            opacity: 0;
            transform: translateY(10px);
            color: white;
        }

        .profile-card.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .profile-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(0,0,0,0.3);
            background: rgba(40, 40, 60, 0.9);
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 3px;
        }

        .profile-icon {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            flex-shrink: 0;
        }

        .profile-1 .profile-icon { background: linear-gradient(45deg, #ff6b6b, #ee5a52); }
        .profile-2 .profile-icon { background: linear-gradient(45deg, #48dbfb, #0abde3); }
        .profile-3 .profile-icon { background: linear-gradient(45deg, #1dd1a1, #10ac84); }
        .profile-4 .profile-icon { background: linear-gradient(45deg, #f368e0, #ff9ff3); }
        .profile-5 .profile-icon { background: linear-gradient(45deg, #ff9f43, #feca57); }

        .profile-info {
            text-align: left;
            flex: 1;
        }

        .profile-name {
            font-size: 0.65rem;
            font-weight: bold;
            color: white;
            margin-bottom: 1px;
        }

        .profile-category {
            font-size: 0.55rem;
            color: #a0aec0;
        }

        .profile-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 3px;
        }

        .profile-rating {
            display: flex;
            align-items: center;
            gap: 1px;
            color: #f6e05e;
            font-weight: bold;
            font-size: 0.55rem;
        }

        .profile-price {
            font-size: 0.55rem;
            color: #a0aec0;
            background: rgba(160, 174, 192, 0.1);
            padding: 1px 3px;
            border-radius: 3px;
        }

        /* Кнопка на странице 1 */
        .start-button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 25px;
            font-size: 0.8rem;
            font-weight: bold;
            border-radius: 45px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.35);
            transition: all 0.3s ease;
            margin-top: 10px;
            border: 2px solid rgba(102, 126, 234, 0.25);
            width: 100%;
            max-width: 280px;
            opacity: 0;
            transform: translateY(10px);
        }

        .start-button.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .start-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 15px rgba(102, 126, 234, 0.5);
        }

        /* СТРАНИЦА 2: Категории */
        .categories-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            width: 100%;
            max-width: 320px;
            margin: 15px 0;
            flex: 1;
            overflow-y: auto;
            max-height: 50vh;
            padding: 5px;
        }

        /* Темный скроллбар */
        .categories-container::-webkit-scrollbar {
            width: 6px;
        }

        .categories-container::-webkit-scrollbar-track {
            background: rgba(30, 30, 46, 0.5);
            border-radius: 3px;
        }

        .categories-container::-webkit-scrollbar-thumb {
            background: rgba(102, 126, 234, 0.6);
            border-radius: 3px;
        }

        .categories-container::-webkit-scrollbar-thumb:hover {
            background: rgba(102, 126, 234, 0.8);
        }

        .category-card {
            background: rgba(30, 30, 46, 0.8);
            border-radius: 16px;
            padding: 15px 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            border: 2px solid rgba(255,255,255,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            opacity: 0;
            transform: translateY(10px);
            color: white;
        }

        .category-card.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .category-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            border-color: rgba(102, 126, 234, 0.4);
            background: rgba(40, 40, 60, 0.9);
        }

        .category-card.selected {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-color: rgba(102, 126, 234, 0.6);
        }

        .category-icon {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .category-name {
            font-size: 0.75rem;
            font-weight: bold;
            color: inherit;
            text-align: center;
        }

        /* Кнопка на странице 2 */
        .next-button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 0.9rem;
            font-weight: bold;
            border-radius: 45px;
            cursor: pointer;
            box-shadow: 0 6px 18px rgba(102, 126, 234, 0.35);
            transition: all 0.3s ease;
            margin-top: 10px;
            border: 2px solid rgba(102, 126, 234, 0.25);
            width: 100%;
            max-width: 280px;
            opacity: 0;
            transform: translateY(10px);
        }

        .next-button.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .next-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
        }

        .next-button:disabled {
            background: #4a5568;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 4px 12px rgba(74, 85, 104, 0.35);
        }

        /* Стили для страницы маршрута */
        .route-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
            max-width: 350px;
            margin: 15px 0;
            flex: 1;
            overflow-y: auto;
            padding: 5px;
        }

        .route-place {
            background: rgba(30, 30, 46, 0.9);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            border: 2px solid rgba(255,255,255,0.1);
            text-align: left;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .route-place:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            border-color: rgba(102, 126, 234, 0.4);
        }

        .route-place.active {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .route-place-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .route-place-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .route-place-info {
            flex: 1;
        }

        .route-place-name {
            font-size: 1rem;
            font-weight: bold;
            color: white;
            margin-bottom: 3px;
        }

        .route-place-category {
            font-size: 0.8rem;
            color: #a0aec0;
        }

        .route-place-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }

        .route-place-rating {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #f6e05e;
            font-weight: bold;
            font-size: 0.85rem;
        }

        .route-place-price {
            font-size: 0.8rem;
            color: #a0aec0;
            background: rgba(160, 174, 192, 0.1);
            padding: 4px 8px;
            border-radius: 6px;
        }

        .route-place-description {
            margin-top: 8px;
            font-size: 0.8rem;
            color: #cbd5e0;
            line-height: 1.4;
        }

        .route-place-features {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .route-feature-tag {
            background: rgba(102, 126, 234, 0.2);
            color: #90cdf4;
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
        }

        .route-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
            max-width: 350px;
        }

        .route-button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 0.9rem;
            font-weight: bold;
            border-radius: 45px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.35);
            transition: all 0.3s ease;
            border: 2px solid rgba(102, 126, 234, 0.25);
        }

        .route-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(102, 126, 234, 0.5);
        }

        .route-button.secondary {
            background: rgba(74, 85, 104, 0.8);
        }

        .route-button.tertiary {
            background: rgba(102, 126, 234, 0.3);
            border: 2px solid rgba(102, 126, 234, 0.5);
        }

        /* Стили для карты */
        #map {
            width: 100%;
            height: 300px;
            border-radius: 12px;
            margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            border: 2px solid rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
        }

        .map-container {
            width: 100%;
            max-width: 350px;
            position: relative;
        }

        .route-info {
            background: rgba(30, 30, 46, 0.8);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 15px;
            text-align: left;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .route-info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.8rem;
        }

        .route-info-item:last-child {
            margin-bottom: 0;
        }

        .route-info-label {
            color: #a0aec0;
        }

        .route-info-value {
            color: white;
            font-weight: bold;
        }

        /* Поиск */
        .search-container {
            width: 100%;
            max-width: 350px;
            margin-bottom: 15px;
        }

        .search-input {
            width: 100%;
            padding: 12px 15px;
            border-radius: 25px;
            border: 2px solid rgba(102, 126, 234, 0.3);
            background: rgba(30, 30, 46, 0.8);
            color: white;
            font-size: 0.9rem;
            outline: none;
        }

        .search-input:focus {
            border-color: #667eea;
        }

        .search-input::placeholder {
            color: #a0aec0;
        }

        /* Темная тема карты с цветами приложения */
        .ymaps-2-1-79-map {
            filter: invert(0.9) hue-rotate(180deg) contrast(1.2) brightness(0.8) saturate(1.4) sepia(0.1);
        }

        .ymaps-2-1-79-inner-panes {
            filter: invert(0.9) hue-rotate(180deg) contrast(1.2) brightness(0.8) saturate(1.4) sepia(0.1);
        }

        /* Скрываем элементы Яндекс Карт */
        .ymaps-2-1-79-copyrights-pane,
        .ymaps-2-1-79-islets_icon_content,
        .ymaps-2-1-79-route-pedestrian-icon,
        .ymaps-2-1-79-route-pedestrian-panel,
        .ymaps-2-1-79-route-pedestrian-view,
        .ymaps-2-1-79-route-pedestrian-sign,
        .ymaps-2-1-79-route-pedestrian-title,
        .ymaps-2-1-79-route-pedestrian-via,
        .ymaps-2-1-79-route-pedestrian-point {
            display: none !important;
        }

        /* Скрываем человечков и другие пешеходные элементы */
        .ymaps-2-1-79-route-pedestrian {
            display: none !important;
        }

        .ymaps-2-1-79-route-pedestrian-route-view {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Страница 1: Примеры мест -->
    <div class="page active" id="page1">
        <div class="header">
            <h1 class="title">Great Date</h1>
            <p class="subtitle">Лучшие места для вашей встречи</p>
        </div>

        <div class="profiles-container">
            <!-- Профиль 1 -->
            <div class="profile-card profile-1">
                <div class="profile-header">
                    <div class="profile-icon">🍽️</div>
                    <div class="profile-info">
                        <div class="profile-name">Terrassa</div>
                        <div class="profile-category">Ресторан с панорамным видом</div>
                    </div>
                </div>
                <div class="profile-details">
                    <div class="profile-rating">⭐ 4.7</div>
                    <div class="profile-price">💰💰💰</div>
                </div>
            </div>

            <!-- Профиль 2 -->
            <div class="profile-card profile-2">
                <div class="profile-header">
                    <div class="profile-icon">🎭</div>
                    <div class="profile-info">
                        <div class="profile-name">Мариинский театр</div>
                        <div class="profile-category">Театр оперы и балета</div>
                    </div>
                </div>
                <div class="profile-details">
                    <div class="profile-rating">⭐ 4.9</div>
                    <div class="profile-price">💰💰💰</div>
                </div>
            </div>

            <!-- Профиль 3 -->
            <div class="profile-card profile-3">
                <div class="profile-header">
                    <div class="profile-icon">🍸</div>
                    <div class="profile-info">
                        <div class="profile-name">El Copitas</div>
                        <div class="profile-category">Спикизи-бар</div>
                    </div>
                </div>
                <div class="profile-details">
                    <div class="profile-rating">⭐ 4.8</div>
                    <div class="profile-price">💰💰💰</div>
                </div>
            </div>

            <!-- Профиль 4 -->
            <div class="profile-card profile-4">
                <div class="profile-header">
                    <div class="profile-icon">🧀</div>
                    <div class="profile-info">
                        <div class="profile-name">Khachapuri i Vino</div>
                        <div class="profile-category">Грузинская кухни</div>
                    </div>
                </div>
                <div class="profile-details">
                    <div class="profile-rating">⭐ 4.8</div>
                    <div class="profile-price">💰💰</div>
                </div>
            </div>

            <!-- Профиль 5 -->
            <div class="profile-card profile-5">
                <div class="profile-header">
                    <div class="profile-icon">🎷</div>
                    <div class="profile-info">
                        <div class="profile-name">The Hat Jazz Bar</div>
                        <div class="profile-category">Джаз-бар</div>
                    </div>
                </div>
                <div class="profile-details">
                    <div class="profile-rating">⭐ 4.6</div>
                    <div class="profile-price">💰💰</div>
                </div>
            </div>
        </div>

        <button class="start-button" onclick="goToCategories()">
            Начать поиск
        </button>
    </div>

    <!-- Страница 2: Выбор категорий -->
    <div class="page" id="page2">
        <div class="header">
            <h1 class="title">Выберите категории</h1>
            <p class="subtitle">Отметьте интересные вам виды мест</p>
        </div>

        <div class="search-container">
            <input type="text" class="search-input" id="searchInput" placeholder="Поиск мест..." onkeyup="filterCategories()">
        </div>

        <div class="categories-container" id="categoriesContainer">
            <!-- Категории будут генерироваться динамически -->
        </div>

        <button class="next-button" id="nextButton" onclick="generateRoute()" disabled>
            Найти места
        </button>
    </div>

    <!-- Страница 3: Маршрут -->
    <div class="page" id="page3">
        <div class="header">
            <h1 class="title">Ваш автомобильный маршрут</h1>
            <p class="subtitle">Идеальные места для вашего свидания</p>
        </div>

        <div class="map-container">
            <div id="map"></div>
        </div>

        <div class="route-info" id="routeInfo">
            <!-- Информация о маршруте будет здесь -->
        </div>

        <div class="route-container" id="routeContainer">
            <!-- Маршрут будет генерироваться здесь -->
        </div>

        <div class="route-buttons">
            <button class="route-button tertiary" onclick="regenerateRoute()">
                Искать еще раз
            </button>
            <button class="route-button secondary" onclick="goToCategoriesFromRoute()">
                Изменить категории
            </button>
            <button class="route-button" onclick="shareRoute()">
                Поделиться
            </button>
        </div>
    </div>

    <script>
        // РАСШИРЕННАЯ БАЗА ДАННЫХ МЕСТ САНКТ-ПЕТЕРБУРГА (140 мест)
        const placesDatabase = [
            // ========== РЕСТОРАНЫ (30 мест) ==========
            {
                "id": 1, "name": "Terrassa", "categories": ["Рестораны"], "icon": "🍽️", "rating": 4.7, "price": "💰💰💰",
                "description": "Популярный ресторан с панорамной террасой с видом на Казанский собор",
                "features": ["Терраса", "Панорамный вид", "Европейская кухня"], "coordinates": [59.935413, 30.325690]
            },
            {
                "id": 2, "name": "Mansarda", "categories": ["Рестораны"], "icon": "🍽️", "rating": 4.8, "price": "💰💰💰💰",
                "description": "Ресторан с видом на Исаакиевский собор, сочетает современную европейскую и русскую кухни",
                "features": ["Панорамный вид", "Европейская кухня", "Русская кухня"], "coordinates": [59.932951, 30.308228]
            },
            {
                "id": 3, "name": "Birch", "categories": ["Рестораны"], "icon": "🍽️", "rating": 4.6, "price": "💰💰💰💰",
                "description": "Современный ресторан с авторской кухней от известного шефа Владимира Чистякова",
                "features": ["Авторская кухня", "Премиум"], "coordinates": [59.943086, 30.358969]
            },
            {
                "id": 4, "name": "Khachapuri i Vino", "categories": ["Рестораны"], "icon": "🧀", "rating": 4.8, "price": "💰💰",
                "description": "Уютный ресторан грузинской кухни с аутентичной атмосферой",
                "features": ["Грузинская кухня", "Уютная атмосфера", "Хачапури"], "coordinates": [59.927778, 30.346389]
            },
            {
                "id": 5, "name": "Il Lago dei Cigni", "categories": ["Рестораны"], "icon": "🍝", "rating": 4.7, "price": "💰💰💰",
                "description": "Романтичный ресторан итальянской кухни с видом на Михайловский замок",
                "features": ["Итальянская кухня", "Романтическая атмосфера"], "coordinates": [59.941944, 30.337778]
            },
            {
                "id": 6, "name": "Harvest", "categories": ["Рестораны"], "icon": "🍲", "rating": 4.6, "price": "💰💰💰",
                "description": "Ресторан современной русской кухни с акцентом на локальные фермерские продукты",
                "features": ["Русская кухня", "Фермерские продукты"], "coordinates": [59.928451, 30.346899]
            },
            {
                "id": 7, "name": "Bourgeois Bohemians", "categories": ["Рестораны", "Бары"], "icon": "🍸", "rating": 4.4, "price": "💰💰",
                "description": "Бохо-шик ресторан с эклектичным меню и живой музыкой",
                "features": ["Живая музыка", "Бар", "Бохо-атмосфера"], "coordinates": [59.926944, 30.346389]
            },
            {
                "id": 8, "name": "Salone pasta & bar", "categories": ["Рестораны"], "icon": "🍝", "rating": 4.5, "price": "💰💰",
                "description": "Стильное заведение, специализирующееся на пасте и коктейлях",
                "features": ["Паста", "Коктейли", "Итальянская кухня"], "coordinates": [59.935278, 30.327222]
            },
            {
                "id": 9, "name": "Frantsuza Bistro", "categories": ["Рестораны"], "icon": "🥖", "rating": 4.6, "price": "💰💰",
                "description": "Уютное французское бистро с аутентичной атмосферой",
                "features": ["Французская кухня", "Бистро", "Уютная атмосфера"], "coordinates": [59.944167, 30.348611]
            },
            {
                "id": 10, "name": "Ginza", "categories": ["Рестораны"], "icon": "🍣", "rating": 4.5, "price": "💰💰💰",
                "description": "Сетевой ресторан японской кухни с широким выбором суши и роллов",
                "features": ["Японская кухня", "Суши", "Роллы"], "coordinates": [59.933056, 30.355278]
            },
            {
                "id": 11, "name": "Chaykhana", "categories": ["Рестораны"], "icon": "🫖", "rating": 4.4, "price": "💰💰",
                "description": "Ресторан восточной кухни с уютными кабинками и кальянами",
                "features": ["Восточная кухня", "Кальяны", "Уютные кабинки"], "coordinates": [59.924722, 30.354167]
            },
            {
                "id": 12, "name": "Sadko", "categories": ["Рестораны"], "icon": "🎻", "rating": 4.7, "price": "💰💰💰",
                "description": "Ресторан русской кухни с живой музыкой в историческом центре",
                "features": ["Русская кухня", "Живая музыка", "Исторический интерьер"], "coordinates": [59.932500, 30.330833]
            },
            {
                "id": 13, "name": "Market Place", "categories": ["Рестораны"], "icon": "🥗", "rating": 4.3, "price": "💰💰",
                "description": "Демократичный ресторан с кухней разных народов мира",
                "features": ["Международная кухня", "Демократичные цены"], "coordinates": [59.936389, 30.319444]
            },
            {
                "id": 14, "name": "Tanuki", "categories": ["Рестораны"], "icon": "🍱", "rating": 4.5, "price": "💰💰",
                "description": "Сетевой ресторан азиатской кухни с демократичными ценами",
                "features": ["Азиатская кухня", "Демократичные цены"], "coordinates": [59.929722, 30.361667]
            },
            {
                "id": 15, "name": "Cheese Cake Cafe", "categories": ["Рестораны"], "icon": "🍰", "rating": 4.4, "price": "💰💰",
                "description": "Уютное кафе с широким выбором чизкейков и европейской кухней",
                "features": ["Чизкейки", "Европейская кухня", "Уютная атмосфера"], "coordinates": [59.934722, 30.358056]
            },
            {
                "id": 16, "name": "Ukrop", "categories": ["Рестораны"], "icon": "🥦", "rating": 4.6, "price": "💰💰",
                "description": "Ресторан здорового питания с вегетарианскими и веганскими блюдами",
                "features": ["Здоровое питание", "Вегетарианское", "Веганское"], "coordinates": [59.938611, 30.361111]
            },
            {
                "id": 17, "name": "Probka", "categories": ["Рестораны"], "icon": "🍝", "rating": 4.7, "price": "💰💰",
                "description": "Сетевой ресторан итальянской кухни с домашней пастой",
                "features": ["Итальянская кухня", "Домашняя паста", "Уютная атмосфера"], "coordinates": [59.944444, 30.358889]
            },
            {
                "id": 18, "name": "Grazhdanin", "categories": ["Рестораны"], "icon": "🍔", "rating": 4.3, "price": "💰💰",
                "description": "Бургерная премиум-класса с авторскими бургерами и крафтовым пивом",
                "features": ["Бургеры", "Крафтовое пиво", "Премиум"], "coordinates": [59.927500, 30.342500]
            },
            {
                "id": 19, "name": "Makarov", "categories": ["Рестораны"], "icon": "🥩", "rating": 4.8, "price": "💰💰💰💰",
                "description": "Стейк-хаус премиум-класса с мясом высшей категории",
                "features": ["Стейки", "Премиум", "Мясо высшей категории"], "coordinates": [59.931111, 30.351667]
            },
            {
                "id": 20, "name": "Volna", "categories": ["Рестораны"], "icon": "🐟", "rating": 4.5, "price": "💰💰💰",
                "description": "Ресторан морской кухни с свежими морепродуктами",
                "features": ["Морепродукты", "Рыба", "Морская кухня"], "coordinates": [59.939722, 30.308889]
            },
            {
                "id": 21, "name": "Duo", "categories": ["Рестораны"], "icon": "👥", "rating": 4.6, "price": "💰💰💰",
                "description": "Ресторан азиатской кухни с вьетнамскими и тайскими блюдами",
                "features": ["Азиатская кухня", "Вьетнамская", "Тайская"], "coordinates": [59.935000, 30.332222]
            },
            {
                "id": 22, "name": "Salk", "categories": ["Рестораны"], "icon": "🌮", "rating": 4.4, "price": "💰💰",
                "description": "Ресторан мексиканской кухни с острыми блюдами и текилой",
                "features": ["Мексиканская кухня", "Текила", "Острые блюда"], "coordinates": [59.928889, 30.351389]
            },
            {
                "id": 23, "name": "Koryushka", "categories": ["Рестораны"], "icon": "🐟", "rating": 4.7, "price": "💰💰💰",
                "description": "Ресторан русской кухни с видом на Неву и Петропавловскую крепость",
                "features": ["Русская кухня", "Вид на Неву", "Историческая атмосфера"], "coordinates": [59.953056, 30.329444]
            },
            {
                "id": 24, "name": "Bellevue", "categories": ["Рестораны"], "icon": "🏛️", "rating": 4.8, "price": "💰💰💰💰",
                "description": "Люксовый ресторан с панорамным видом на исторический центр",
                "features": ["Люкс", "Панорамный вид", "Европейская кухня"], "coordinates": [59.934167, 30.305833]
            },
            {
                "id": 25, "name": "Golitsyn", "categories": ["Рестораны"], "icon": "🥂", "rating": 4.5, "price": "💰💰💰",
                "description": "Ресторан в дворцовом интерьере с классической русской кухней",
                "features": ["Дворцовый интерьер", "Русская кухня", "Классика"], "coordinates": [59.937500, 30.334722]
            },
            {
                "id": 26, "name": "Literatura", "categories": ["Рестораны"], "icon": "📚", "rating": 4.6, "price": "💰💰💰",
                "description": "Ресторан в литературном стиле с меню по мотивам классических произведений",
                "features": ["Литературная тема", "Креативная кухня", "Интеллектуальная атмосфера"], "coordinates": [59.939167, 30.340833]
            },
            {
                "id": 27, "name": "SVO", "categories": ["Рестораны"], "icon": "✈️", "rating": 4.4, "price": "💰💰",
                "description": "Ресторан в авиационной тематике с меню разных стран мира",
                "features": ["Авиационная тема", "Международная кухня", "Креативный интерьер"], "coordinates": [59.931389, 30.363889]
            },
            {
                "id": 28, "name": "Mesto", "categories": ["Рестораны"], "icon": "📍", "rating": 4.5, "price": "💰💰",
                "description": "Современный ресторан с авторской кухней и минималистичным дизайном",
                "features": ["Авторская кухня", "Минимализм", "Современный дизайн"], "coordinates": [59.929167, 30.347222]
            },
            {
                "id": 29, "name": "Sunduk", "categories": ["Рестораны"], "icon": "🎁", "rating": 4.3, "price": "💰💰",
                "description": "Уютный ресторан с домашней кухней и атмосферой старого Петербурга",
                "features": ["Домашняя кухня", "Атмосфера Петербурга", "Уют"], "coordinates": [59.942500, 30.352778]
            },
            {
                "id": 30, "name": "Kuhnya", "categories": ["Рестораны"], "icon": "👨‍🍳", "rating": 4.7, "price": "💰💰💰",
                "description": "Ресторан с открытой кухней, где можно наблюдать за работой поваров",
                "features": ["Открытая кухня", "Шоу-кухня", "Авторские блюда"], "coordinates": [59.936111, 30.341667]
            },

            // ========== БАРЫ (30 мест) ==========
            {
                "id": 31, "name": "El Copitas", "categories": ["Бары"], "icon": "🥃", "rating": 4.8, "price": "💰💰💰",
                "description": "Легендарный спикизи-бар с мексиканской атмосферой и редким алкоголем",
                "features": ["Спикизи", "Редкий алкоголь", "Мексиканская кухня"], "coordinates": [59.927778, 30.354722]
            },
            {
                "id": 32, "name": "The Hat Jazz Bar", "categories": ["Бары", "Джаз-клубы"], "icon": "🎷", "rating": 4.6, "price": "💰💰",
                "description": "Легендарный джаз-бар с живыми выступлениями и аутентичной атмосферой",
                "features": ["Живой джаз", "Аутентичная атмосфера"], "coordinates": [59.932778, 30.343056]
            },
            {
                "id": 33, "name": "Bar Quinta", "categories": ["Бары", "Винные бары"], "icon": "🍷", "rating": 4.7, "price": "💰💰💰",
                "description": "Уютный бар с обширной коллекцией креплёных вин и авторскими коктейлями",
                "features": ["Винная карта", "Авторские коктейли", "Камерная атмосфера"], "coordinates": [59.935000, 30.351111]
            },
            {
                "id": 34, "name": "Apotheke Bar", "categories": ["Бары"], "icon": "🍸", "rating": 4.6, "price": "💰💰💰",
                "description": "Скрытый бар в стиле аптеки с индивидуальным подходом к каждому гостю",
                "features": ["Спикизи", "Индивидуальные коктейли", "Скрытый бар"], "coordinates": [59.928889, 30.347222]
            },
            {
                "id": 35, "name": "MoonShine", "categories": ["Бары"], "icon": "🍹", "rating": 4.5, "price": "💰💰",
                "description": "Бар с качественными коктейлями ручной работы и неброской атмосферой",
                "features": ["Коктейли ручной работы", "Расслабленная атмосфера"], "coordinates": [59.934167, 30.323611]
            },
            {
                "id": 36, "name": "Кабинет (Kabinet)", "categories": ["Бары"], "icon": "📚", "rating": 4.4, "price": "💰💰",
                "description": "Бар в стиле дореволюционного кабинета с атмосферой старого Петербурга",
                "features": ["Историческая атмосфера", "Классические коктейли"], "coordinates": [59.936389, 30.328056]
            },
            {
                "id": 37, "name": "Dead Poets", "categories": ["Бары"], "icon": "✒️", "rating": 4.5, "price": "💰💰",
                "description": "Бар для ценителей качественных классических коктейлей и спокойной атмосферы",
                "features": ["Классические коктейли", "Расслабленная атмосфера"], "coordinates": [59.935833, 30.352500]
            },
            {
                "id": 38, "name": "Communal Bar", "categories": ["Бары"], "icon": "🏢", "rating": 4.3, "price": "💰💰",
                "description": "Бар в стиле советской коммуналки с ностальгической атмосферой",
                "features": ["Советская атмосфера", "Ностальгия", "Демократичные цены"], "coordinates": [59.930556, 30.349722]
            },
            {
                "id": 39, "name": "Griboyedov", "categories": ["Бары"], "icon": "🎵", "rating": 4.4, "price": "💰💰",
                "description": "Культовый бар с альтернативной музыкой и андеграундной атмосферой",
                "features": ["Альтернативная музыка", "Андеграунд", "Живые выступления"], "coordinates": [59.926389, 30.348611]
            },
            {
                "id": 40, "name": "Central Station", "categories": ["Бары"], "icon": "🚉", "rating": 4.2, "price": "💰💰",
                "description": "Бар в стиле железнодорожного вокзала с разнообразной музыкой",
                "features": ["Железнодорожная тема", "Разная музыка", "Просторный зал"], "coordinates": [59.933889, 30.356667]
            },
            {
                "id": 41, "name": "Fish Fabrique", "categories": ["Бары"], "icon": "🎨", "rating": 4.5, "price": "💰💰",
                "description": "Легендарный бар в арт-центре на Пушкинской с творческой атмосферой",
                "features": ["Арт-пространство", "Творческая атмосфера", "Концерты"], "coordinates": [59.928056, 30.347500]
            },
            {
                "id": 42, "name": "Mishka", "categories": ["Бары"], "icon": "🐻", "rating": 4.6, "price": "💰💰",
                "description": "Модный бар с крафтовыми коктейлями и современной атмосферой",
                "features": ["Крафтовые коктейли", "Модная атмосфера", "Дизайнерские интерьеры"], "coordinates": [59.934444, 30.345833]
            },
            {
                "id": 43, "name": "Jazz Philharmonic", "categories": ["Бары", "Джаз-клубы"], "icon": "🎺", "rating": 4.7, "price": "💰💰💰",
                "description": "Джаз-клуб при филармонии с выступлениями мировых звезд",
                "features": ["Джаз", "Мировые звезды", "Акустика"], "coordinates": [59.931667, 30.350000]
            },
            {
                "id": 44, "name": "St. Petersburg Distillery", "categories": ["Бары"], "icon": "🥃", "rating": 4.5, "price": "💰💰💰",
                "description": "Крафтовая дистиллерия с собственными настойками и дистиллятами",
                "features": ["Крафтовая дистиллерия", "Собственные настойки", "Дегустации"], "coordinates": [59.937222, 30.359444]
            },
            {
                "id": 45, "name": "40 Gradusov", "categories": ["Бары"], "icon": "🌡️", "rating": 4.3, "price": "💰💰",
                "description": "Бар с огромной коллекцией крепкого алкоголя со всего мира",
                "features": ["Коллекция алкоголя", "Крепкие напитки", "Разнообразие"], "coordinates": [59.935556, 30.353889]
            },
            {
                "id": 46, "name": "Union", "categories": ["Бары"], "icon": "🤝", "rating": 4.4, "price": "💰💰",
                "description": "Бар с комфортной атмосферой и качественными напитками",
                "features": ["Комфортная атмосфера", "Качественные напитки", "Дружелюбный персонал"], "coordinates": [59.936667, 30.355000]
            },
            {
                "id": 47, "name": "Mono", "categories": ["Бары"], "icon": "🔉", "rating": 4.2, "price": "💰💰",
                "description": "Бар с минималистичным дизайном и электронной музыкой",
                "features": ["Минимализм", "Электронная музыка", "Современный дизайн"], "coordinates": [59.938889, 30.357778]
            },
            {
                "id": 48, "name": "Terminal", "categories": ["Бары"], "icon": "🛬", "rating": 4.3, "price": "💰💰",
                "description": "Бар в авиационной тематике с коктейлями разных стран",
                "features": ["Авиационная тема", "Международные коктейли", "Креативная подача"], "coordinates": [59.939444, 30.358889]
            },
            {
                "id": 49, "name": "Bar 812", "categories": ["Бары"], "icon": "🔢", "rating": 4.5, "price": "💰💰",
                "description": "Бар с авторскими коктейлями по мотивам Санкт-Петербурга",
                "features": ["Авторские коктейли", "Петербургская тема", "Креатив"], "coordinates": [59.940000, 30.360000]
            },
            {
                "id": 50, "name": "SOS", "categories": ["Бары"], "icon": "🆘", "rating": 4.4, "price": "💰💰",
                "description": "Спасательный бар с коктейлями на любой случай жизни",
                "features": ["Тема спасения", "Разнообразные коктейли", "Неформальная атмосфера"], "coordinates": [59.941111, 30.361111]
            },
            {
                "id": 51, "name": "Molecule", "categories": ["Бары"], "icon": "⚗️", "rating": 4.6, "price": "💰💰💰",
                "description": "Научный бар с молекулярными коктейлями и экспериментами",
                "features": ["Молекулярные коктейли", "Научная тема", "Эксперименты"], "coordinates": [59.942222, 30.362222]
            },
            {
                "id": 52, "name": "Library", "categories": ["Бары"], "icon": "📖", "rating": 4.5, "price": "💰💰",
                "description": "Бар в стиле библиотеки с интеллектуальной атмосферой",
                "features": ["Библиотечная атмосфера", "Интеллектуальная публика", "Тихая музыка"], "coordinates": [59.943333, 30.363333]
            },
            {
                "id": 53, "name": "Chaos", "categories": ["Бары"], "icon": "🌀", "rating": 4.3, "price": "💰💰",
                "description": "Бар с хаотичным, но стильным интерьером и громкой музыкой",
                "features": ["Хаотичный интерьер", "Громкая музыка", "Молодежная атмосфера"], "coordinates": [59.944444, 30.364444]
            },
            {
                "id": 54, "name": "Paradox", "categories": ["Бары"], "icon": "❓", "rating": 4.4, "price": "💰💰",
                "description": "Бар с парадоксальными коктейлями и необычными сочетаниями",
                "features": ["Парадоксальные коктейли", "Необычные сочетания", "Эксперименты"], "coordinates": [59.945556, 30.365556]
            },
            {
                "id": 55, "name": "Nectar", "categories": ["Бары"], "icon": "🍯", "rating": 4.5, "price": "💰💰",
                "description": "Бар с сладкими коктейлями и десертными напитками",
                "features": ["Сладкие коктейли", "Десертные напитки", "Романтическая атмосфера"], "coordinates": [59.946667, 30.366667]
            },
            {
                "id": 56, "name": "Bunker", "categories": ["Бары"], "icon": "🕳️", "rating": 4.2, "price": "💰💰",
                "description": "Подземный бар в стиле бункера с индустриальной атмосферой",
                "features": ["Подземный", "Индустриальная атмосфера", "Альтернативная музыка"], "coordinates": [59.947778, 30.367778]
            },
            {
                "id": 57, "name": "Sky", "categories": ["Бары"], "icon": "☁️", "rating": 4.7, "price": "💰💰💰",
                "description": "Люксовый бар на крыше с панорамным видом на город",
                "features": ["Бар на крыше", "Панорамный вид", "Люксовая атмосфера"], "coordinates": [59.948889, 30.368889]
            },
            {
                "id": 58, "name": "Garden", "categories": ["Бары"], "icon": "🌿", "rating": 4.4, "price": "💰💰",
                "description": "Летний бар с открытой террасой и растительным оформлением",
                "features": ["Открытая терраса", "Растительное оформление", "Летняя атмосфера"], "coordinates": [59.949444, 30.369444]
            },
            {
                "id": 59, "name": "Ice", "categories": ["Бары"], "icon": "🧊", "rating": 4.3, "price": "💰💰",
                "description": "Бар с ледяными коктейлями и прохладной атмосферой",
                "features": ["Ледяные коктейли", "Прохладная атмосфера", "Необычная подача"], "coordinates": [59.950000, 30.370000]
            },
            {
                "id": 60, "name": "Fire", "categories": ["Бары"], "icon": "🔥", "rating": 4.5, "price": "💰💰",
                "description": "Бар с острыми коктейлями и горячими напитками",
                "features": ["Острые коктейли", "Горячие напитки", "Теплая атмосфера"], "coordinates": [59.950556, 30.370556]
            },

            // ========== МУЗЕИ (30 мест) ==========
            {
                "id": 61, "name": "Эрмитаж", "categories": ["Музеи"], "icon": "🏛️", "rating": 4.9, "price": "💰💰",
                "description": "Один из крупнейших художественных музеев мира с богатейшей коллекцией",
                "features": ["Искусство", "История", "Архитектура"], "coordinates": [59.939806, 30.314553]
            },
            {
                "id": 62, "name": "Русский музей", "categories": ["Музеи"], "icon": "🎨", "rating": 4.8, "price": "💰💰",
                "description": "Крупнейший музей русского искусства в мире",
                "features": ["Русское искусство", "Живопись", "Скульптура"], "coordinates": [59.939167, 30.332222]
            },
            {
                "id": 63, "name": "Кунсткамера", "categories": ["Музеи"], "icon": "🔬", "rating": 4.5, "price": "💰💰",
                "description": "Первый музей России, основанный Петром I",
                "features": ["Антропология", "Этнография", "История науки"], "coordinates": [59.941389, 30.304167]
            },
            {
                "id": 64, "name": "Петропавловская крепость", "categories": ["Музеи"], "icon": "🏰", "rating": 4.7, "price": "💰💰",
                "description": "Историческая крепость, место основания Санкт-Петербурга",
                "features": ["История", "Архитектура", "Панорамный вид"], "coordinates": [59.950000, 30.316667]
            },
            {
                "id": 65, "name": "Исаакиевский собор", "categories": ["Музеи"], "icon": "⛪", "rating": 4.8, "price": "💰💰",
                "description": "Крупнейший православный храм Санкт-Петербурга",
                "features": ["Архитектура", "Религия", "Панорамный вид"], "coordinates": [59.934167, 30.306111]
            },
            {
                "id": 66, "name": "Спас на Крови", "categories": ["Музеи"], "icon": "💒", "rating": 4.8, "price": "💰💰",
                "description": "Православный мемориальный храм на месте убийства Александра II",
                "features": ["Мозаики", "Архитектура", "История"], "coordinates": [59.940000, 30.328889]
            },
            {
                "id": 67, "name": "Зоологический музей", "categories": ["Музеи"], "icon": "🐘", "rating": 4.6, "price": "💰💰",
                "description": "Один из крупнейших зоологических музеев мира",
                "features": ["Животные", "Таксидермия", "Естественная история"], "coordinates": [59.942500, 30.305278]
            },
            {
                "id": 68, "name": "Музей политической истории", "categories": ["Музеи"], "icon": "⚖️", "rating": 4.4, "price": "💰💰",
                "description": "Музей политической истории России XX века",
                "features": ["Политика", "История", "Документы"], "coordinates": [59.955556, 30.327778]
            },
            {
                "id": 69, "name": "Музей Арктики и Антарктики", "categories": ["Музеи"], "icon": "🧊", "rating": 4.5, "price": "💰💰",
                "description": "Единственный в России музей, посвященный полярным регионам",
                "features": ["Арктика", "Антарктика", "Экспедиции"], "coordinates": [59.928611, 30.361389]
            },
            {
                "id": 70, "name": "Музей Фаберже", "categories": ["Музеи"], "icon": "🥚", "rating": 4.7, "price": "💰💰💰",
                "description": "Музей с самой большой коллекцией произведений Фаберже",
                "features": ["Ювелирное искусство", "Фаберже", "Роскошь"], "coordinates": [59.944722, 30.327778]
            },
            {
                "id": 71, "name": "Музей-квартира Пушкина", "categories": ["Музеи"], "icon": "📝", "rating": 4.6, "price": "💰💰",
                "description": "Мемориальная квартира, где поэт провел последние дни",
                "features": ["Пушкин", "Литература", "История"], "coordinates": [59.941111, 30.324722]
            },
            {
                "id": 72, "name": "Музей Достоевского", "categories": ["Музеи"], "icon": "📚", "rating": 4.5, "price": "💰💰",
                "description": "Музей-квартира Ф.М. Достоевского",
                "features": ["Достоевский", "Литература", "История"], "coordinates": [59.925556, 30.348056]
            },
            {
                "id": 73, "name": "Музей Ахматовой", "categories": ["Музеи"], "icon": "✒️", "rating": 4.6, "price": "💰💰",
                "description": "Музей-квартира Анны Ахматовой в Фонтанном Доме",
                "features": ["Ахматова", "Поэзия", "Серебряный век"], "coordinates": [59.933889, 30.345833]
            },
            {
                "id": 74, "name": "Музей театрального искусства", "categories": ["Музеи"], "icon": "🎭", "rating": 4.4, "price": "💰💰",
                "description": "Музей, посвященный истории русского театра",
                "features": ["Театр", "История", "Костюмы"], "coordinates": [59.936944, 30.335278]
            },
            {
                "id": 75, "name": "Музей музыки", "categories": ["Музеи"], "icon": "🎵", "rating": 4.5, "price": "💰💰",
                "description": "Музей с коллекцией музыкальных инструментов",
                "features": ["Музыка", "Инструменты", "История"], "coordinates": [59.922778, 30.300000]
            },
            {
                "id": 76, "name": "Музей железных дорог", "categories": ["Музеи"], "icon": "🚂", "rating": 4.7, "price": "💰💰",
                "description": "Один из крупнейших железнодорожных музеев мира",
                "features": ["Железные дороги", "Поезда", "История"], "coordinates": [59.907222, 30.298611]
            },
            {
                "id": 77, "name": "Музей воды", "categories": ["Музеи"], "icon": "💧", "rating": 4.3, "price": "💰💰",
                "description": "Музей, посвященный водоснабжению города",
                "features": ["Вода", "История", "Интерактив"], "coordinates": [59.945833, 30.420833]
            },
            {
                "id": 78, "name": "Музей сновидений Фрейда", "categories": ["Музеи"], "icon": "💭", "rating": 4.2, "price": "💰💰",
                "description": "Интерактивный музей, посвященный психоанализу и сновидениям",
                "features": ["Фрейд", "Психоанализ", "Сновидения"], "coordinates": [59.934722, 30.336389]
            },
            {
                "id": 79, "name": "Музей советских игровых автоматов", "categories": ["Музеи"], "icon": "🎮", "rating": 4.6, "price": "💰💰",
                "description": "Интерактивный музей с игровыми автоматами советской эпохи",
                "features": ["Игровые автоматы", "Ностальгия", "Интерактив"], "coordinates": [59.932500, 30.341667]
            },
            {
                "id": 80, "name": "Музей энтомологии", "categories": ["Музеи"], "icon": "🐞", "rating": 4.4, "price": "💰💰",
                "description": "Музей насекомых с уникальной коллекцией",
                "features": ["Насекомые", "Энтомология", "Естественная история"], "coordinates": [59.941667, 30.303333]
            },
            {
                "id": 81, "name": "Музей хлеба", "categories": ["Музеи"], "icon": "🍞", "rating": 4.3, "price": "💰💰",
                "description": "Музей, посвященный истории хлебопечения",
                "features": ["Хлеб", "История", "Пекарное дело"], "coordinates": [59.927778, 30.388889]
            },
            {
                "id": 82, "name": "Музей игрушки", "categories": ["Музеи"], "icon": "🧸", "rating": 4.5, "price": "💰💰",
                "description": "Музей с коллекцией игрушек разных эпох",
                "features": ["Игрушки", "Детство", "История"], "coordinates": [59.950000, 30.350000]
            },
            {
                "id": 83, "name": "Музей циркового искусства", "categories": ["Музеи"], "icon": "🎪", "rating": 4.4, "price": "💰💰",
                "description": "Единственный в России музей циркового искусства",
                "features": ["Цирк", "Искусство", "История"], "coordinates": [59.928056, 30.343056]
            },
            {
                "id": 84, "name": "Музей кукол", "categories": ["Музеи"], "icon": "🎎", "rating": 4.6, "price": "💰💰",
                "description": "Музей с коллекцией кукол со всего мира",
                "features": ["Куклы", "Искусство", "Разные культуры"], "coordinates": [59.922222, 30.250000]
            },
            {
                "id": 85, "name": "Музей восковых фигур", "categories": ["Музеи"], "icon": "🕴️", "rating": 4.3, "price": "💰💰",
                "description": "Музей с восковыми фигурами известных личностей",
                "features": ["Восковые фигуры", "Знаменитости", "История"], "coordinates": [59.936111, 30.329167]
            },
            {
                "id": 86, "name": "Музей метрополитена", "categories": ["Музеи"], "icon": "🚇", "rating": 4.5, "price": "💰💰",
                "description": "Музей, посвященный истории петербургского метро",
                "features": ["Метро", "История", "Техника"], "coordinates": [59.916667, 30.316667]
            },
            {
                "id": 87, "name": "Музей кофе", "categories": ["Музеи"], "icon": "☕", "rating": 4.4, "price": "💰💰",
                "description": "Интерактивный музей, посвященный истории и культуре кофе",
                "features": ["Кофе", "История", "Дегустации"], "coordinates": [59.938889, 30.318889]
            },
            {
                "id": 88, "name": "Музей шоколада", "categories": ["Музеи"], "icon": "🍫", "rating": 4.5, "price": "💰💰",
                "description": "Музей, посвященный истории шоколада и его производству",
                "features": ["Шоколад", "История", "Дегустации"], "coordinates": [59.933333, 30.325000]
            },
            {
                "id": 89, "name": "Музей парфюмерии", "categories": ["Музеи"], "icon": "💄", "rating": 4.3, "price": "💰💰",
                "description": "Музей с историей парфюмерии и ароматов",
                "features": ["Парфюмерия", "Ароматы", "История"], "coordinates": [59.937500, 30.326389]
            },
            {
                "id": 90, "name": "Музей моды", "categories": ["Музеи"], "icon": "👗", "rating": 4.4, "price": "💰💰",
                "description": "Музей, посвященный истории моды и костюма",
                "features": ["Мода", "Костюмы", "История"], "coordinates": [59.939722, 30.328056]
            },

            // ========== ТЕАТРЫ (10 мест) ==========
            {
                "id": 91, "name": "Мариинский театр", "categories": ["Театры"], "icon": "🎭", "rating": 4.9, "price": "💰💰💰",
                "description": "Всемирно известный театр оперы и балета",
                "features": ["Опера", "Балет", "Оркестр"], "coordinates": [59.925553, 30.296044]
            },
            {
                "id": 92, "name": "Александринский театр", "categories": ["Театры"], "icon": "🎭", "rating": 4.8, "price": "💰💰💰",
                "description": "Старейший национальный театр России",
                "features": ["Драма", "Историческое здание"], "coordinates": [59.931556, 30.336361]
            },
            {
                "id": 93, "name": "Михайловский театр", "categories": ["Театры"], "icon": "🎭", "rating": 4.8, "price": "💰💰💰",
                "description": "Значительный театр оперы и балета в Санкт-Петербурге",
                "features": ["Опера", "Балет"], "coordinates": [59.939167, 30.331667]
            },
            {
                "id": 94, "name": "БДТ им. Товстоногова", "categories": ["Театры"], "icon": "🎪", "rating": 4.7, "price": "💰💰",
                "description": "Один из первых театров, созданных после Октябрьской революции",
                "features": ["Драма", "Классика", "Современные постановки"], "coordinates": [59.928056, 30.341389]
            },
            {
                "id": 95, "name": "МДТ - Театр Европы", "categories": ["Театры"], "icon": "🎪", "rating": 4.7, "price": "💰💰",
                "description": "Академический театр под руководством Льва Додина",
                "features": ["Драма", "Европейские стандарты"], "coordinates": [59.928889, 30.344722]
            },
            {
                "id": 96, "name": "Театр Комедии им. Акимова", "categories": ["Театры"], "icon": "😂", "rating": 4.6, "price": "💰💰",
                "description": "Театр комедии с богатой историей и талантливой труппой",
                "features": ["Комедия", "Классика", "Современные пьесы"], "coordinates": [59.933611, 30.343056]
            },
            {
                "id": 97, "name": "Театр Ленсовета", "categories": ["Театры"], "icon": "🎬", "rating": 4.5, "price": "💰💰",
                "description": "Популярный театр с разнообразным репертуаром",
                "features": ["Драма", "Комедия", "Современные постановки"], "coordinates": [59.920278, 30.347222]
            },
            {
                "id": 98, "name": "Театр на Литейном", "categories": ["Театры"], "icon": "💡", "rating": 4.4, "price": "💰💰",
                "description": "Камерный театр с экспериментальными постановками",
                "features": ["Экспериментальные постановки", "Камерность", "Современная драма"], "coordinates": [59.941111, 30.351389]
            },
            {
                "id": 99, "name": "Молодежный театр на Фонтанке", "categories": ["Театры"], "icon": "🎓", "rating": 4.5, "price": "💰💰",
                "description": "Театр с молодежной направленностью и современным репертуаром",
                "features": ["Молодежная аудитория", "Современные пьесы", "Эксперименты"], "coordinates": [59.927778, 30.342500]
            },
            {
                "id": 100, "name": "Театр Балтийский дом", "categories": ["Театры"], "icon": "🏠", "rating": 4.4, "price": "💰💰",
                "description": "Международный театральный фестивальный центр",
                "features": ["Международные фестивали", "Современная драма", "Эксперименты"], "coordinates": [59.955000, 30.317222]
            },

            // ========== ПАРКИ (20 мест) ==========
            {
                "id": 101, "name": "Летний сад", "categories": ["Парки"], "icon": "🌳", "rating": 4.8, "price": "Бесплатно",
                "description": "Старейший сад Санкт-Петербурга с фонтанами, скульптурами и красивыми аллеями",
                "features": ["Прогулки", "Фонтаны", "Скульптуры"], "coordinates": [59.945278, 30.335833]
            },
            {
                "id": 102, "name": "Марсово поле", "categories": ["Парки"], "icon": "⚔️", "rating": 4.5, "price": "Бесплатно",
                "description": "Большой парк в центре города, место проведения мероприятий",
                "features": ["Прогулки", "Мероприятия", "Историческое место"], "coordinates": [59.943889, 30.332222]
            },
            {
                "id": 103, "name": "Таврический сад", "categories": ["Парки"], "icon": "🏛️", "rating": 4.6, "price": "Бесплатно",
                "description": "Пейзажный парк с прудом и историческими постройками",
                "features": ["Прогулки", "Пруд", "Исторические постройки"], "coordinates": [59.946389, 30.375833]
            },
            {
                "id": 104, "name": "Александровский парк", "categories": ["Парки"], "icon": "🏰", "rating": 4.5, "price": "Бесплатно",
                "description": "Парк у Петропавловской крепости с аттракционами",
                "features": ["Прогулки", "Аттракционы", "Историческое место"], "coordinates": [59.954167, 30.317500]
            },
            {
                "id": 105, "name": "Юсуповский сад", "categories": ["Парки"], "icon": "💎", "rating": 4.4, "price": "Бесплатно",
                "description": "Небольшой, но очень уютный сад в центре города",
                "features": ["Прогулки", "Уютная атмосфера", "Историческое место"], "coordinates": [59.924722, 30.298611]
            },
            {
                "id": 106, "name": "Парк 300-летия Санкт-Петербурга", "categories": ["Парки"], "icon": "🎉", "rating": 4.7, "price": "Бесплатно",
                "description": "Современный парк на берегу Финского залива",
                "features": ["Прогулки", "Пляж", "Современная архитектура"], "coordinates": [59.984722, 30.198611]
            },
            {
                "id": 107, "name": "Приморский парк Победы", "categories": ["Парки"], "icon": "🏆", "rating": 4.6, "price": "Бесплатно",
                "description": "Большой парк на Крестовском острове",
                "features": ["Прогулки", "Спорт", "Отдых"], "coordinates": [59.971389, 30.258333]
            },
            {
                "id": 108, "name": "Ботанический сад", "categories": ["Парки"], "icon": "🌿", "rating": 4.7, "price": "💰💰",
                "description": "Один из старейших ботанических садов России",
                "features": ["Растения", "Оранжереи", "Научная работа"], "coordinates": [59.970000, 30.324722]
            },
            {
                "id": 109, "name": "Ленинградский зоопарк", "categories": ["Парки"], "icon": "🐯", "rating": 4.5, "price": "💰💰",
                "description": "Один из старейших зоопарков России",
                "features": ["Животные", "Развлечения", "Образование"], "coordinates": [59.954444, 30.303611]
            },
            {
                "id": 110, "name": "Елагин остров", "categories": ["Парки"], "icon": "🏝️", "rating": 4.8, "price": "💰",
                "description": "Парк на острове с дворцом и красивыми видами",
                "features": ["Прогулки", "Дворец", "Живописные виды"], "coordinates": [59.978333, 30.258333]
            },
            {
                "id": 111, "name": "Аптекарский огород", "categories": ["Парки"], "icon": "🌱", "rating": 4.4, "price": "💰",
                "description": "Исторический парк с лекарственными растениями",
                "features": ["Лекарственные растения", "История", "Уютная атмосфера"], "coordinates": [59.966667, 30.320833]
            },
            {
                "id": 112, "name": "Сад дружбы", "categories": ["Парки"], "icon": "🤝", "rating": 4.3, "price": "Бесплатно",
                "description": "Небольшой сад в японском стиле",
                "features": ["Японский стиль", "Уют", "Спокойная атмосфера"], "coordinates": [59.931111, 30.360278]
            },
            {
                "id": 113, "name": "Парк современной скульптуры", "categories": ["Парки"], "icon": "🗿", "rating": 4.5, "price": "Бесплатно",
                "description": "Парк с современными скульптурами и арт-объектами",
                "features": ["Современное искусство", "Скульптуры", "Арт-объекты"], "coordinates": [59.940000, 30.370000]
            },
            {
                "id": 114, "name": "Сад Сан-Галли", "categories": ["Парки"], "icon": "🏭", "rating": 4.2, "price": "Бесплатно",
                "description": "Лофт-парк на территории бывшего завода",
                "features": ["Лофт", "Индустриальная атмосфера", "Современное искусство"], "coordinates": [59.911111, 30.375000]
            },
            {
                "id": 115, "name": "Оранжерея Таврического сада", "categories": ["Парки"], "icon": "🏵️", "rating": 4.6, "price": "💰💰",
                "description": "Тропическая оранжерея в историческом парке",
                "features": ["Тропические растения", "Оранжерея", "Историческое место"], "coordinates": [59.947222, 30.376389]
            },
            {
                "id": 116, "name": "Парк Малиновка", "categories": ["Парки"], "icon": "🍓", "rating": 4.3, "price": "Бесплатно",
                "description": "Большой парк в спальном районе с озерами",
                "features": ["Прогулки", "Озера", "Спорт"], "coordinates": [60.031944, 30.418611]
            },
            {
                "id": 117, "name": "Парк Интернационалистов", "categories": ["Парки"], "icon": "🌍", "rating": 4.4, "price": "Бесплатно",
                "description": "Парк, посвященный памяти воинов-интернационалистов",
                "features": ["Памятник", "Прогулки", "Спорт"], "coordinates": [59.849722, 30.473611]
            },
            {
                "id": 118, "name": "Парк Сосновка", "categories": ["Парки"], "icon": "🌲", "rating": 4.5, "price": "Бесплатно",
                "description": "Большой лесопарк в черте города",
                "features": ["Лес", "Прогулки", "Спорт"], "coordinates": [60.016667, 30.366667]
            },
            {
                "id": 119, "name": "Удельный парк", "categories": ["Парки"], "icon": "🌳", "rating": 4.4, "price": "Бесплатно",
                "description": "Исторический парк с лесным массивом",
                "features": ["Лес", "История", "Прогулки"], "coordinates": [60.008333, 30.316667]
            },
            {
                "id": 120, "name": "Парк Челюскинцев", "categories": ["Парки"], "icon": "🚢", "rating": 4.3, "price": "Бесплатно",
                "description": "Парк, посвященный героям-челюскинцам",
                "features": ["История", "Прогулки", "Спорт"], "coordinates": [59.966667, 30.466667]
            },

            // ========== КИНОТЕАТРЫ (20 мест) ==========
            {
                "id": 121, "name": "Аврора", "categories": ["Кино"], "icon": "🎬", "rating": 4.5, "price": "💰💰",
                "description": "Кинотеатр премиум-класса в историческом здании",
                "features": ["Новинки", "Комфортные залы", "Премиум"], "coordinates": [59.932500, 30.333333]
            },
            {
                "id": 122, "name": "Англетер", "categories": ["Кино"], "icon": "🏨", "rating": 4.4, "price": "💰💰",
                "description": "Кинотеатр в отеле с уютными залами",
                "features": ["Новинки", "Уютные залы", "Комфорт"], "coordinates": [59.933611, 30.308889]
            },
            {
                "id": 123, "name": "Родина", "categories": ["Кино"], "icon": "❤️", "rating": 4.6, "price": "💰💰",
                "description": "Кинотеатр с историей, показывающий артхаусное кино",
                "features": ["Артхаус", "Историческое здание", "Классика кино"], "coordinates": [59.928056, 30.355556]
            },
            {
                "id": 124, "name": "Великан Парк", "categories": ["Кино"], "icon": "🎡", "rating": 4.5, "price": "💰💰",
                "description": "Кинотеатр в торговом центре с современным оборудованием",
                "features": ["Новинки", "Современное оборудование", "IMAX"], "coordinates": [59.978611, 30.216667]
            },
            {
                "id": 125, "name": "Формула Кино Галерея", "categories": ["Кино"], "icon": "🛍️", "rating": 4.4, "price": "💰💰",
                "description": "Современный кинотеатр в торговом центре",
                "features": ["Новинки", "Комфортные кресла", "3D"], "coordinates": [59.931944, 30.354167]
            },
            {
                "id": 126, "name": "Каро Фильм Авеню", "categories": ["Кино"], "icon": "🏪", "rating": 4.5, "price": "💰💰",
                "description": "Сетевой кинотеатр с современными залами",
                "features": ["Новинки", "Современные залы", "Комфорт"], "coordinates": [59.929167, 30.362500]
            },
            {
                "id": 127, "name": "Ленфильм", "categories": ["Кино"], "icon": "🎥", "rating": 4.6, "price": "💰💰",
                "description": "Кинотеатр на легендарной киностудии",
                "features": ["Премьеры", "История кино", "Эксклюзивные показы"], "coordinates": [59.945833, 30.336111]
            },
            {
                "id": 128, "name": "Дом Кино", "categories": ["Кино"], "icon": "🏠", "rating": 4.5, "price": "💰💰",
                "description": "Кинотеатр для ценителей авторского кино",
                "features": ["Авторское кино", "Фестивали", "Творческие вечера"], "coordinates": [59.936389, 30.337500]
            },
            {
                "id": 129, "name": "Мираж Синема", "categories": ["Кино"], "icon": "🎪", "rating": 4.4, "price": "💰💰",
                "description": "Сетевой кинотеатр с разнообразным репертуаром",
                "features": ["Новинки", "Разнообразный репертуар", "Комфорт"], "coordinates": [59.924722, 30.318056]
            },
            {
                "id": 130, "name": "Родина 2", "categories": ["Кино"], "icon": "❤️", "rating": 4.3, "price": "💰💰",
                "description": "Второй зал кинотеатра Родина с уютной атмосферой",
                "features": ["Артхаус", "Уютная атмосфера", "Классика"], "coordinates": [59.927778, 30.356944]
            },
            {
                "id": 131, "name": "Кинотеатр в Книжном", "categories": ["Кино"], "icon": "📚", "rating": 4.2, "price": "💰💰",
                "description": "Небольшой кинотеатр в книжном магазине",
                "features": ["Камерные показы", "Интеллектуальное кино", "Уютная атмосфера"], "coordinates": [59.934722, 30.358333]
            },
            {
                "id": 132, "name": "Пионер", "categories": ["Кино"], "icon": "👦", "rating": 4.5, "price": "💰💰",
                "description": "Кинотеатр, специализирующийся на авторском кино",
                "features": ["Авторское кино", "Фестивали", "Обсуждения"], "coordinates": [59.966389, 30.311667]
            },
            {
                "id": 133, "name": "Аврора Парк", "categories": ["Кино"], "icon": "🎬", "rating": 4.4, "price": "💰💰",
                "description": "Современный кинотеатр в торговом центре",
                "features": ["Новинки", "Современное оборудование", "Комфорт"], "coordinates": [59.850000, 30.150000]
            },
            {
                "id": 134, "name": "Синема Стар", "categories": ["Кино"], "icon": "⭐", "rating": 4.3, "price": "💰💰",
                "description": "Сетевой кинотеатр с залами повышенной комфортности",
                "features": ["Новинки", "Комфортные кресла", "Долгий прокат"], "coordinates": [59.948611, 30.475000]
            },
            {
                "id": 135, "name": "Формула Киро", "categories": ["Кино"], "icon": "🔢", "rating": 4.4, "price": "💰💰",
                "description": "Кинотеатр с современными технологиями",
                "features": ["Новинки", "Современные технологии", "Комфорт"], "coordinates": [59.884722, 30.318056]
            },
            {
                "id": 136, "name": "Каро 9", "categories": ["Кино"], "icon": "9️⃣", "rating": 4.5, "price": "💰💰",
                "description": "Кинотеатр с девятью залами разного размера",
                "features": ["Новинки", "Разные залы", "Комфорт"], "coordinates": [59.931111, 30.363889]
            },
            {
                "id": 137, "name": "Охта Молл", "categories": ["Кино"], "icon": "🏬", "rating": 4.4, "price": "💰💰",
                "description": "Кинотеатр в крупном торговом центре",
                "features": ["Новинки", "Большие залы", "Комфорт"], "coordinates": [59.953889, 30.471389]
            },
            {
                "id": 138, "name": "Монитор", "categories": ["Кино"], "icon": "📺", "rating": 4.3, "price": "💰💰",
                "description": "Небольшой кинотеатр с камерной атмосферой",
                "features": ["Камерная атмосфера", "Артхаус", "Обсуждения"], "coordinates": [59.929444, 30.360278]
            },
            {
                "id": 139, "name": "Киноцентр", "categories": ["Кино"], "icon": "🎦", "rating": 4.5, "price": "💰💰",
                "description": "Кинотеатр с несколькими залами разного формата",
                "features": ["Разные форматы", "Новинки", "Комфорт"], "coordinates": [59.933889, 30.365278]
            },
            {
                "id": 140, "name": "Синема Парк", "categories": ["Кино"], "icon": "🎪", "rating": 4.4, "price": "💰💰",
                "description": "Современный кинотеатр с парком развлечений",
                "features": ["Новинки", "Развлечения", "Комфорт"], "coordinates": [59.930556, 30.366667]
            }
        ];

        let selectedCategories = [];
        let usedPlacesHistory = new Set();
        let map;
        let route;
        let currentRoute = [];
        let userLocation = null;

        // Получение уникальных категорий из базы данных
        function getAllCategories() {
            const categories = new Set();
            placesDatabase.forEach(place => {
                place.categories.forEach(category => categories.add(category));
            });
            return Array.from(categories);
        }

        // Динамическое создание категорий
        function initializeCategories() {
            const categoriesContainer = document.getElementById('categoriesContainer');
            const categories = getAllCategories();
            
            categoriesContainer.innerHTML = '';
            
            categories.forEach(category => {
                const categoryCard = document.createElement('div');
                categoryCard.className = 'category-card';
                categoryCard.onclick = () => toggleCategory(categoryCard);
                
                // Определяем иконку для категории
                let icon = '📍';
                switch(category) {
                    case 'Рестораны': icon = '🍽️'; break;
                    case 'Бары': icon = '🍸'; break;
                    case 'Музеи': icon = '🏛️'; break;
                    case 'Театры': icon = '🎭'; break;
                    case 'Парки': icon = '🌳'; break;
                    case 'Кино': icon = '🎬'; break;
                    case 'Джаз-клубы': icon = '🎷'; break;
                    case 'Винные бары': icon = '🍷'; break;
                }
                
                categoryCard.innerHTML = `
                    <div class="category-icon">${icon}</div>
                    <div class="category-name">${category}</div>
                `;
                
                categoriesContainer.appendChild(categoryCard);
            });
            
            // Анимация появления категорий
            animateCategories();
        }

        // Фильтрация категорий по поиску
        function filterCategories() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const categoryCards = document.querySelectorAll('.category-card');
            
            categoryCards.forEach(card => {
                const categoryName = card.querySelector('.category-name').textContent.toLowerCase();
                if (categoryName.includes(searchTerm)) {
                    card.style.display = 'flex';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Инициализация Яндекс Карт с автомобильным маршрутом
        function initMap(routePlaces) {
            if (!routePlaces || routePlaces.length === 0) return;
            
            currentRoute = routePlaces;
            
            // Уничтожаем предыдущую карту, если она существует
            if (map) {
                map.destroy();
            }
            
            // Создаем карту с темной темой
            ymaps.ready(function() {
                map = new ymaps.Map("map", {
                    center: [59.94, 30.31],
                    zoom: 13
                }, {
                    // Убираем лишние элементы управления
                    suppressMapOpenBlock: true,
                    suppressObsoleteBrowserNotifier: true
                });

                // Оставляем только нужные элементы управления
                map.controls.remove('geolocationControl');
                map.controls.remove('trafficControl');
                map.controls.remove('typeSelector');
                map.controls.remove('rulerControl');
                map.controls.remove('searchControl');
                map.controls.remove('routeButtonControl');

                // Создаем кастомные метки с номерами
                routePlaces.forEach((place, index) => {
                    const placemark = new ymaps.Placemark(
                        place.coordinates,
                        {
                            // Минимальная информация в балуне
                            balloonContent: `
                                <div style="color: #333; padding: 8px; max-width: 200px;">
                                    <strong style="color: #667eea; font-size: 14px;">${index + 1}. ${place.name}</strong>
                                    <div style="font-size: 12px; margin-top: 4px; color: #666;">${place.categories.join(', ')}</div>
                                </div>
                            `,
                            // Подпись с номером
                            iconCaption: `${index + 1}`
                        },
                        {
                            // Кастомные иконки с цветами приложения и подписями
                            preset: 'islands#circleIcon',
                            iconColor: getPlaceColor(index),
                            iconCaptionMaxWidth: 30
                        }
                    );
                    
                    map.geoObjects.add(placemark);
                });
                
                // Строим автомобильный маршрут между точками
                if (routePlaces.length > 1) {
                    // Создаем мультимаршрут для автомобиля
                    const multiRoute = new ymaps.multiRouter.MultiRoute({
                        referencePoints: routePlaces.map(place => place.coordinates),
                        params: {
                            routingMode: 'auto' // Автомобильный маршрут
                        }
                    }, {
                        boundsAutoApply: true,
                        // Настройки для сплошной линии маршрута с цветами приложения
                        routeActiveStrokeWidth: 6,
                        routeActiveStrokeColor: "#667eea",
                        routeActiveStrokeStyle: 'solid',
                        routeStrokeWidth: 6,
                        routeStrokeColor: "#667eea",
                        routeStrokeStyle: 'solid',
                        // Убираем ВСЕ точки и подписи маршрута
                        wayPointStartIconFillColor: 'transparent',
                        wayPointStartIconStrokeColor: 'transparent',
                        wayPointFinishIconFillColor: 'transparent',
                        wayPointFinishIconStrokeColor: 'transparent',
                        viaPointIconFillColor: 'transparent',
                        viaPointIconStrokeColor: 'transparent',
                        pinIconFillColor: 'transparent',
                        pinIconStrokeColor: 'transparent',
                        // Скрываем все элементы интерфейса маршрута
                        wayPointVisible: false,
                        viaPointVisible: false,
                        pinVisible: false
                    });
                    
                    // Добавляем маршрут на карту
                    map.geoObjects.add(multiRoute);
                    
                    // Получаем информацию о маршруте
                    multiRoute.model.events.add('requestsuccess', function() {
                        const activeRoute = multiRoute.getActiveRoute();
                        if (activeRoute) {
                            const routeLength = (activeRoute.properties.get("distance").value / 1000).toFixed(1);
                            const routeTime = Math.round(activeRoute.properties.get("duration").value / 60);
                            
                            updateRouteInfo(routeLength, routeTime, routePlaces.length);
                            
                            // Масштабируем карту чтобы показать весь маршрут
                            map.setBounds(multiRoute.getBounds(), {
                                checkZoomRange: true,
                                zoomMargin: 30
                            });
                        }
                    });

                    // Скрываем панель маршрутизации
                    setTimeout(() => {
                        const routePanel = document.querySelector('.ymaps-2-1-79-route-panel');
                        if (routePanel) {
                            routePanel.style.display = 'none';
                        }
                    }, 100);
                } else {
                    // Если только одно место, центрируем на нем
                    map.setCenter(routePlaces[0].coordinates, 15);
                    updateRouteInfo(0, 0, 1);
                }
                
                // Применяем темную тему к карте
                applyDarkTheme();
            });
        }

        // Функция для цветов меток в стиле приложения
        function getPlaceColor(index) {
            const colors = [
                '#667eea', '#764ba2', '#f093fb', '#ff6b6b', '#48dbfb',
                '#1dd1a1', '#feca57', '#ff9ff3', '#54a0ff', '#5f27cd'
            ];
            return colors[index % colors.length];
        }

        // Функция для применения темной темы к карте
        function applyDarkTheme() {
            // Ждем немного для применения стилей
            setTimeout(() => {
                const mapContainer = document.querySelector('.ymaps-2-1-79-map');
                const innerPanes = document.querySelector('.ymaps-2-1-79-inner-panes');
                
                if (mapContainer) {
                    mapContainer.style.filter = 'invert(0.9) hue-rotate(180deg) contrast(1.2) brightness(0.8) saturate(1.4) sepia(0.1)';
                }
                if (innerPanes) {
                    innerPanes.style.filter = 'invert(0.9) hue-rotate(180deg) contrast(1.2) brightness(0.8) saturate(1.4) sepia(0.1)';
                }
                
                // Дополнительно скрываем элементы
                hideMapElements();
            }, 100);
        }

        // Функция для скрытия элементов карты
        function hideMapElements() {
            const elementsToHide = [
                '.ymaps-2-1-79-route-panel',
                '.ymaps-2-1-79-route-button',
                '.ymaps-2-1-79-islets_icon_content',
                '.ymaps-2-1-79-route-pedestrian-icon',
                '.ymaps-2-1-79-route-pedestrian-panel',
                '.ymaps-2-1-79-copyrights-pane',
                '.ymaps-2-1-79-route-pedestrian',
                '.ymaps-2-1-79-route-pedestrian-route-view',
                '.ymaps-2-1-79-route-pedestrian-view',
                '.ymaps-2-1-79-route-pedestrian-sign',
                '.ymaps-2-1-79-route-pedestrian-title',
                '.ymaps-2-1-79-route-pedestrian-via',
                '.ymaps-2-1-79-route-pedestrian-point'
            ];
            
            elementsToHide.forEach(selector => {
                const element = document.querySelector(selector);
                if (element) {
                    element.style.display = 'none';
                }
            });
        }

        // Получение текущего местоположения
        function getCurrentLocation() {
            return new Promise((resolve) => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        position => {
                            resolve([position.coords.latitude, position.coords.longitude]);
                        },
                        error => {
                            console.log('Ошибка получения геолокации:', error);
                            resolve(null);
                        },
                        {
                            enableHighAccuracy: true,
                            timeout: 5000,
                            maximumAge: 0
                        }
                    );
                } else {
                    resolve(null);
                }
            });
        }

        // Обновление информации о маршруте
        function updateRouteInfo(distance, time, placesCount) {
            const routeInfo = document.getElementById('routeInfo');
            routeInfo.innerHTML = `
                <div class="route-info-item">
                    <span class="route-info-label">Количество мест:</span>
                    <span class="route-info-value">${placesCount}</span>
                </div>
                <div class="route-info-item">
                    <span class="route-info-label">Общее расстояние:</span>
                    <span class="route-info-value">${distance} км</span>
                </div>
                <div class="route-info-item">
                    <span class="route-info-label">Примерное время на машине:</span>
                    <span class="route-info-value">🚗 ${time} мин</span>
                </div>
            `;
        }

        function initTelegram() {
            if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
                Telegram.WebApp.ready();
                Telegram.WebApp.expand();
            }
        }

        // Переход к выбору категорий с первой страницы
        function goToCategories() {
            document.getElementById('page1').classList.remove('active');
            document.getElementById('page2').classList.add('active');
            
            selectedCategories = [];
            const selectedCards = document.querySelectorAll('.category-card.selected');
            selectedCards.forEach(card => card.classList.remove('selected'));
            
            initializeCategories();
        }

        // Переход к выбору категорий с третьей страницы
        function goToCategoriesFromRoute() {
            document.getElementById('page3').classList.remove('active');
            document.getElementById('page2').classList.add('active');
            
            selectedCategories = [];
            const selectedCards = document.querySelectorAll('.category-card.selected');
            selectedCards.forEach(card => card.classList.remove('selected'));
            
            const nextButton = document.getElementById('nextButton');
            nextButton.disabled = true;
            
            document.getElementById('routeContainer').innerHTML = '';
            
            if (map) {
                map.destroy();
                map = null;
            }
        }

        // Регенерация маршрута
        function regenerateRoute() {
            generateRoute();
        }

        // Анимация карточек на первой странице
        function animateFirstPage() {
            const cards = document.querySelectorAll('.profile-card');
            const button = document.querySelector('.start-button');
            let delay = 300;
            
            cards.forEach((card, index) => {
                setTimeout(() => {
                    card.classList.add('visible');
                }, delay * index);
            });
            
            setTimeout(() => {
                button.classList.add('visible');
            }, delay * cards.length + 200);
        }

        // Анимация категорий на второй странице
        function animateCategories() {
            const categories = document.querySelectorAll('.category-card');
            const button = document.querySelector('.next-button');
            let delay = 40;
            
            categories.forEach((category, index) => {
                setTimeout(() => {
                    category.classList.add('visible');
                }, delay * index);
            });
            
            setTimeout(() => {
                button.classList.add('visible');
            }, delay * categories.length + 200);
        }

        // Переключение выбора категории
        function toggleCategory(element) {
            const categoryName = element.querySelector('.category-name').textContent;
            const index = selectedCategories.indexOf(categoryName);
            
            if (index > -1) {
                selectedCategories.splice(index, 1);
                element.classList.remove('selected');
            } else {
                selectedCategories.push(categoryName);
                element.classList.add('selected');
            }
            
            const nextButton = document.getElementById('nextButton');
            nextButton.disabled = selectedCategories.length === 0;
        }

        // Генерация маршрута
        function generateRoute() {
            let suitablePlaces = placesDatabase.filter(place => 
                place.categories.some(category => selectedCategories.includes(category))
            );

            if (suitablePlaces.length === 0) {
                alert('По выбранным категориям не найдено мест');
                return;
            }

            let route = [];
            let usedPlacesInCurrentRoute = new Set();
            
            let availablePlaces = suitablePlaces.filter(place => !usedPlacesHistory.has(place.id));
            
            if (availablePlaces.length < 3) {
                usedPlacesHistory.clear();
                availablePlaces = [...suitablePlaces];
            }

            // Выбираем места для маршрута
            selectedCategories.forEach(category => {
                const categoryPlaces = availablePlaces.filter(place => 
                    place.categories.includes(category) && !usedPlacesInCurrentRoute.has(place.id)
                );
                
                if (categoryPlaces.length > 0) {
                    categoryPlaces.sort((a, b) => b.rating - a.rating);
                    const bestPlace = categoryPlaces[0];
                    route.push(bestPlace);
                    usedPlacesInCurrentRoute.add(bestPlace.id);
                    usedPlacesHistory.add(bestPlace.id);
                    
                    if (categoryPlaces.length > 1 && route.length < 4) {
                        const topPlaces = categoryPlaces.slice(1, 4);
                        const randomPlace = topPlaces[Math.floor(Math.random() * topPlaces.length)];
                        route.push(randomPlace);
                        usedPlacesInCurrentRoute.add(randomPlace.id);
                        usedPlacesHistory.add(randomPlace.id);
                    }
                }
            });

            // Добавляем случайные места если маршрут короткий
            if (route.length < 3) {
                const remainingPlaces = availablePlaces.filter(place => !usedPlacesInCurrentRoute.has(place.id));
                while (route.length < 4 && remainingPlaces.length > 0) {
                    const randomIndex = Math.floor(Math.random() * remainingPlaces.length);
                    const randomPlace = remainingPlaces[randomIndex];
                    route.push(randomPlace);
                    usedPlacesInCurrentRoute.add(randomPlace.id);
                    usedPlacesHistory.add(randomPlace.id);
                    remainingPlaces.splice(randomIndex, 1);
                }
            }

            // Оптимизируем порядок мест для автомобильного маршрута
            route = optimizeCarRoute(route);

            route = route.slice(0, 4);

            showRoute(route);
        }

        // Оптимизация порядка мест для автомобильного маршрута
        function optimizeCarRoute(route) {
            if (route.length <= 1) return route;
            
            // Простой алгоритм ближайшего соседа для автомобильных маршрутов
            let optimized = [route[0]];
            let remaining = route.slice(1);
            
            while (remaining.length > 0) {
                let lastPlace = optimized[optimized.length - 1];
                let closestIndex = 0;
                let closestDistance = calculateDrivingDistance(
                    lastPlace.coordinates[0], lastPlace.coordinates[1],
                    remaining[0].coordinates[0], remaining[0].coordinates[1]
                );
                
                for (let i = 1; i < remaining.length; i++) {
                    let distance = calculateDrivingDistance(
                        lastPlace.coordinates[0], lastPlace.coordinates[1],
                        remaining[i].coordinates[0], remaining[i].coordinates[1]
                    );
                    if (distance < closestDistance) {
                        closestDistance = distance;
                        closestIndex = i;
                    }
                }
                
                optimized.push(remaining[closestIndex]);
                remaining.splice(closestIndex, 1);
            }
            
            return optimized;
        }

        // Функция расчета автомобильного расстояния
        function calculateDrivingDistance(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
            return R * c;
        }

        // Показ маршрута
        function showRoute(route) {
            document.getElementById('page2').classList.remove('active');
            document.getElementById('page3').classList.add('active');

            const routeContainer = document.getElementById('routeContainer');
            routeContainer.innerHTML = '';

            if (route.length === 0) {
                routeContainer.innerHTML = '<div class="route-place"><div class="route-place-description">Не удалось составить маршрут. Попробуйте выбрать другие категории.</div></div>';
                return;
            }

            route.forEach((place, index) => {
                const placeElement = document.createElement('div');
                placeElement.className = 'route-place';
                placeElement.style.animationDelay = `${index * 0.2}s`;
                placeElement.onclick = () => highlightPlaceOnMap(place.id);
                
                placeElement.innerHTML = `
                    <div class="route-place-header">
                        <div class="route-place-icon" style="background: linear-gradient(45deg, ${getRandomColor()})">
                            ${place.icon}
                        </div>
                        <div class="route-place-info">
                            <div class="route-place-name">${index + 1}. ${place.name}</div>
                            <div class="route-place-category">${place.categories.join(', ')}</div>
                        </div>
                    </div>
                    <div class="route-place-description">${place.description}</div>
                    <div class="route-place-features">
                        ${place.features.map(feature => 
                            `<span class="route-feature-tag">${feature}</span>`
                        ).join('')}
                    </div>
                    <div class="route-place-details">
                        <div class="route-place-rating">⭐ ${place.rating}</div>
                        <div class="route-place-price">${place.price}</div>
                    </div>
                `;
                
                routeContainer.appendChild(placeElement);
            });

            initMap(route);
        }

        // Подсветка места на карте
        function highlightPlaceOnMap(placeId) {
            const placeElements = document.querySelectorAll('.route-place');
            placeElements.forEach(el => el.classList.remove('active'));
            
            event.currentTarget.classList.add('active');
            
            // Находим место в текущем маршруте
            const place = currentRoute.find(p => p.id === placeId);
            if (place && map) {
                map.setCenter(place.coordinates, 16);
            }
        }

        // Вспомогательная функция для случайного цвета
        function getRandomColor() {
            const colors = [
                '#ff6b6b, #ee5a52',
                '#48dbfb, #0abde3',
                '#1dd1a1, #10ac84',
                '#f368e0, #ff9ff3',
                '#ff9f43, #feca57'
            ];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // Функция поделиться маршрутом
        function shareRoute() {
            if (currentRoute.length === 0) {
                alert('Сначала создайте маршрут!');
                return;
            }

            // Формируем текст для分享
            let routeText = `🚀 Мой автомобильный маршрут для свидания:\n\n`;
            
            currentRoute.forEach((place, index) => {
                routeText += `${index + 1}. ${place.name}\n`;
                routeText += `   📍 ${place.categories.join(', ')}\n`;
                routeText += `   ⭐ ${place.rating} | ${place.price}\n`;
                routeText += `   ${place.description}\n\n`;
            });
            
            routeText += `📍 Общее расстояние: ${document.querySelector('.route-info-item:nth-child(2) .route-info-value')?.textContent || 'N/A'}\n`;
            routeText += `⏱️ Время в пути: ${document.querySelector('.route-info-item:nth-child(3) .route-info-value')?.textContent || 'N/A'}`;

            // Пытаемся использовать Web Share API если доступно
            if (navigator.share) {
                navigator.share({
                    title: 'Мой автомобильный маршрут для свидания - Great Date',
                    text: routeText,
                    url: window.location.href
                }).then(() => {
                    console.log('Маршрут успешно shared');
                }).catch((error) => {
                    // Fallback: копируем в буфер обмена
                    copyToClipboard(routeText);
                });
            } else {
                // Fallback: копируем в буфер обмена
                copyToClipboard(routeText);
            }
        }

        // Функция для копирования в буфер обмена
        function copyToClipboard(text) {
            // Создаем временный textarea
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            
            // Выделяем и копируем
            textarea.select();
            textarea.setSelectionRange(0, 99999); // Для мобильных устройств
            
            try {
                const successful = document.execCommand('copy');
                document.body.removeChild(textarea);
                
                if (successful) {
                    if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
                        Telegram.WebApp.showPopup({
                            title: 'Успех!',
                            message: 'Маршрут скопирован в буфер обмена! Отправьте его своему спутнику.',
                            buttons: [{ type: 'ok' }]
                        });
                    } else {
                        alert('✅ Маршрут скопирован! Теперь вы можете отправить его своему спутнику в любом мессенджере.');
                    }
                } else {
                    throw new Error('Copy failed');
                }
            } catch (err) {
                document.body.removeChild(textarea);
                // Последний fallback - показываем текст
                if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
                    Telegram.WebApp.showPopup({
                        title: 'Скопируйте маршрут',
                        message: text,
                        buttons: [{ type: 'ok' }]
                    });
                } else {
                    alert('Скопируйте этот текст:\n\n' + text);
                }
            }
        }

        window.onload = function() {
            initTelegram();
            setTimeout(animateFirstPage, 500);
        };
    </script>
</body>
</html>